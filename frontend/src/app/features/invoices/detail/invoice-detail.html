<div class="invoice-detail-container">
  <div class="mb-6">
    <a routerLink="/invoices" class="text-primary-600 hover:text-primary-700 mb-2 inline-block">
      <i class="pi pi-arrow-left mr-2"></i>Back to Invoices
    </a>
  </div>

  @if (loading()) {
    <app-loading-spinner />
  } @else if (error()) {
    <div class="bg-red-50 border border-red-200 rounded-md p-4">
      <p class="text-sm font-medium text-red-800">{{ error() }}</p>
    </div>
  } @else if (invoice()) {
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-800">Invoice #{{ invoice()!.invoiceID }}</h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2">
        @if (invoice()!.hospitalItems.length > 0) {
          <p-card header="Hospital Service Items" class="shadow-sm mb-6">
            <p-table [value]="invoice()!.hospitalItems">
              <ng-template pTemplate="header">
                <tr>
                  <th>Service</th>
                  <th>Line Total</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>{{ item.serviceName }}</td>
                  <td>${{ item.lineTotal }}</td>
                </tr>
              </ng-template>
            </p-table>
          </p-card>
        }

        @if (invoice()!.medicationItems.length > 0) {
          <p-card header="Medication Items" class="shadow-sm mb-6">
            <p-table [value]="invoice()!.medicationItems">
              <ng-template pTemplate="header">
                <tr>
                  <th>Medication</th>
                  <th>Quantity</th>
                  <th>Line Total</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>{{ item.medicationName }}</td>
                  <td>{{ item.quantity }}</td>
                  <td>${{ item.lineTotal }}</td>
                </tr>
              </ng-template>
            </p-table>
          </p-card>
        }
      </div>

      <div>
        <p-card header="Invoice Summary" class="shadow-sm">
          <div class="space-y-4">
            <div>
              <label class="text-sm text-gray-600">Patient</label>
              <p class="font-medium text-gray-800">{{ invoice()!.patientName }}</p>
            </div>
            <div>
              <label class="text-sm text-gray-600">Invoice Type</label>
              <p class="font-medium text-gray-800">{{ invoice()!.invoiceTypeName }}</p>
            </div>
            <div>
              <label class="text-sm text-gray-600">Invoice Date</label>
              <p class="font-medium text-gray-800">{{ invoice()!.invoiceDate }}</p>
            </div>
            @if (invoice()!.payDate) {
              <div>
                <label class="text-sm text-gray-600">Pay Date</label>
                <p class="font-medium text-gray-800">{{ invoice()!.payDate }}</p>
              </div>
            }
            <div>
              <label class="text-sm text-gray-600">Total Amount</label>
              <p class="text-2xl font-bold text-gray-800">${{ invoice()!.totalAmount }}</p>
            </div>
            <div>
              <label class="text-sm text-gray-600">Payment Status</label>
              <p class="font-medium text-gray-800">
                <p-tag [value]="invoice()!.paymentStatusName" 
                       [severity]="invoice()!.paymentStatusName.toLowerCase().includes('paid') ? 'success' : 'warn'"></p-tag>
              </p>
            </div>
          </div>
        </p-card>
      </div>
    </div>
  }
</div>

